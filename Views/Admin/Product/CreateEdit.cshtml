@model Higertech.ViewModels.ProductVM

@{
  Layout = "~/Views/Shared/_ContentNavbarLayout.cshtml";
  ViewData["Title"] = "Dashboard - Analytics";
}
@section VendorStyles {
  <link rel="stylesheet" href="~/vendor/libs/apex-charts/apex-charts.css" />
}
@section VendorScripts {
  <script src="~/vendor/libs/apex-charts/apexcharts.js"></script>
}

@* ************** Content ************** *@
<form id="form-product" data-parsley-validate class="tablelist-form parsley-validation" method="POST" novalidate
  autocomplete="off" onsubmit="createEditForm(this,event)">
  <div class="row">
    <div class="col-xxl-12 mb-6 order-0">
      <div class="card mb-5">
        <h5 class="card-header">
          @(Model.id != Guid.Empty ? "Edit Data" : "Tambah Data")
        </h5>
        <div class="card-body">
          <input type="hidden" asp-for="id" class="form-control" id="id">

          <div>
            <label for="productNama" class="form-label">Nama Produk</label>
            <input type="text" asp-for="nama_produk" class="form-control" id="nama_produk" placeholder="Masukkan nama produk">
          </div>

          <div class="mt-3">
            <label for="productDeskripsi" class="form-label">Deskripsi Produk</label>
            <input type="text" asp-for="deskripsi" class="form-control" id="deskripsi" placeholder="Masukkan keterangan">
          </div>

          <div class="mt-3">
            <label for="productKategori" class="form-label">Kategori</label>
            <input type="text" asp-for="kategori" class="form-control" id="kategori" placeholder="Masukkan kategori produk">
          </div>

          <div class="mt-3">
            <label for="productGambar" class="form-label">URL Gambar</label>
            <input type="text" asp-for="gambar_url" class="form-control" id="gambar_url" placeholder="Masukkan URL gambar">
          </div>

          <div class="mt-3 float-end">
            <button type="submit" class="btn btn-primary">Save</button>
          </div>

        </div>
      </div>
    </div>
  </div>
</form>

@section PageScripts {
  <script src="~/js/dashboards-analytics.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/parsley.js/2.9.2/parsley.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0/js/select2.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.7/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
    window.createEditForm = (form, evt) => {
      evt.preventDefault();

      var btnSubmit = $(form).find("button[type=submit]");
      var id = document.getElementById("id").value;

      $(form).parsley().validate();
      if ($(form).parsley().isValid()) {
        beforeLoadingButton(btnSubmit);

        let formData = new FormData();
        formData.append("id", document.getElementById("id").value);
        formData.append("nama_produk", document.getElementById("nama_produk").value);
        formData.append("deskripsi", document.getElementById("deskripsi").value);
        formData.append("kategori", document.getElementById("kategori").value);
        formData.append("gambar_url", document.getElementById("gambar_url").value);

        console.log("FormData:", Object.fromEntries(formData.entries()));

        axios.post("/Admin/SaveProduct", formData)
          .then((res) => {
            let result = res.data;
            if (result.code == 200) {
              Swal.fire("Sukses!", result.message, "success");
              dataTableProduct.ajax.reload();
            } else {
              Swal.fire("Gagal!", result.message, "error");
            }
            afterLoadingButton(btnSubmit);
          })
          .catch((err) => {
            console.log(err);
            Swal.fire("Gagal!", "Terjadi kesalahan saat menyimpan data.", "error");
            afterLoadingButton(btnSubmit);
          });
      }
    };
  </script>
}
